<!DOCTYPE html>
<html>
<head>
    <title>–ü–µ—Ä–≤–æ–∞–ø—Ä–µ–ª—å—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (HTTP)</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial; text-align: center; margin-top: 50px; background: #f0f0f0; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 10px; }
        button { padding: 15px 30px; margin: 10px; font-size: 18px; cursor: pointer; border: none; border-radius: 5px; }
        #clientBtn { background: #4CAF50; color: white; }
        #adminBtn { background: #f44336; color: white; }
        input { padding: 10px; font-size: 16px; margin: 5px; width: 200px; }
        .hidden { display: none; }
        #log { margin-top: 20px; text-align: left; background: #eee; padding: 10px; border-radius: 5px; height: 200px; overflow-y: auto; }
        .command-btn { background: #008CBA; color: white; padding: 10px 15px; margin: 5px; font-size: 14px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé≠ –ü–µ—Ä–≤–æ–∞–ø—Ä–µ–ª—å—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (HTTP)</h1>
        <p><em>–¢–æ–ª—å–∫–æ —Å —Å–æ–≥–ª–∞—Å–∏—è –¥—Ä—É–≥–∞!</em></p>

        <div id="roleSelection">
            <button id="clientBtn">–Ø –∫–ª–∏–µ–Ω—Ç (–∂–µ—Ä—Ç–≤–∞)</button>
            <button id="adminBtn">–Ø –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</button>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å –∫–ª–∏–µ–Ω—Ç–∞ -->
        <div id="clientPanel" class="hidden">
            <h2>–ö–ª–∏–µ–Ω—Ç</h2>
            <p>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã (4 —Ü–∏—Ñ—Ä—ã):</p>
            <input type="text" id="clientRoom" maxlength="4" placeholder="1234">
            <button id="connectClient">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
            <div id="clientStatus"></div>
            <div id="clientLog" class="hidden">
                <h3>–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</h3>
                <div id="clientCommands"></div>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
        <div id="adminPanel" class="hidden">
            <h2>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</h2>
            <p>–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã:</p>
            <input type="text" id="adminRoom" maxlength="4" placeholder="1234">
            <p>–ü–∞—Ä–æ–ª—å:</p>
            <input type="password" id="adminPassword" placeholder="******">
            <button id="connectAdmin">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
            <div id="adminStatus"></div>
            <div id="adminCommands" class="hidden">
                <h3>–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞:</h3>
                <button class="command-btn" onclick="sendCommand('rickroll')">üéµ Rick Roll</button>
                <button class="command-btn" onclick="sendCommand('notify')">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</button>
                <button class="command-btn" onclick="sendCommand('beep')">üîä –ó–≤—É–∫</button>
                <button class="command-btn" onclick="sendCommand('changebg')">üé® –°–º–µ–Ω–∏—Ç—å —Ñ–æ–Ω</button>
                <button class="command-btn" onclick="sendCommand('alert')">‚ö†Ô∏è –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ</button>
                <button class="command-btn" onclick="sendCommand('vibrate')">üì≥ –í–∏–±—Ä–∞—Ü–∏—è (–º–æ–±.)</button>
                <button class="command-btn" onclick="sendCommand('getLocation')">üìç –ó–∞–ø—Ä–æ—Å–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é</button>
                <button class="command-btn" onclick="sendCommand('openWindow')">ü™ü –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ</button>
            </div>
        </div>

        <div id="log"></div>
    </div>

    <script>
        // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ (–±–µ–∑ / –≤ –∫–æ–Ω—Ü–µ)
        const SERVER_URL = 'https://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä.onrender.com';  // –Ω–∞–ø—Ä–∏–º–µ—Ä, https://april-http.onrender.com

        let currentRoom = '';
        let isAdmin = false;
        let pollInterval = null;

        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const clientBtn = document.getElementById('clientBtn');
        const adminBtn = document.getElementById('adminBtn');
        const clientPanel = document.getElementById('clientPanel');
        const adminPanel = document.getElementById('adminPanel');
        const logDiv = document.getElementById('log');

        clientBtn.addEventListener('click', () => {
            document.getElementById('roleSelection').classList.add('hidden');
            clientPanel.classList.remove('hidden');
        });

        adminBtn.addEventListener('click', () => {
            document.getElementById('roleSelection').classList.add('hidden');
            adminPanel.classList.remove('hidden');
        });

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
        document.getElementById('connectClient').addEventListener('click', async () => {
            const room = document.getElementById('clientRoom').value.trim();
            if (!room || room.length !== 4 || !/^\d+$/.test(room)) {
                alert('–í–≤–µ–¥–∏—Ç–µ 4 —Ü–∏—Ñ—Ä—ã');
                return;
            }
            currentRoom = room;
            isAdmin = false;

            // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–æ–º–Ω–∞—Ç—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
            try {
                const res = await fetch(`${SERVER_URL}/api/client/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ room })
                });
                const data = await res.json();
                if (data.error) throw new Error(data.error);
                log('–ö–ª–∏–µ–Ω—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ –∫–æ–º–Ω–∞—Ç–µ ' + room);
                document.getElementById('clientStatus').innerText = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ. –ñ–¥—É –∫–æ–º–∞–Ω–¥...';
                document.getElementById('clientLog').classList.remove('hidden');
                // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–ø—Ä–æ—Å –∫–æ–º–∞–Ω–¥
                startPolling(room);
            } catch (err) {
                alert('–û—à–∏–±–∫–∞: ' + err.message);
            }
        });

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        document.getElementById('connectAdmin').addEventListener('click', async () => {
            const room = document.getElementById('adminRoom').value.trim();
            const password = document.getElementById('adminPassword').value.trim();
            if (!room || room.length !== 4 || !/^\d+$/.test(room)) {
                alert('–í–≤–µ–¥–∏—Ç–µ 4 —Ü–∏—Ñ—Ä—ã');
                return;
            }
            if (password !== '7355608') {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
                return;
            }
            currentRoom = room;
            isAdmin = true;
            document.getElementById('adminStatus').innerText = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
            document.getElementById('adminCommands').classList.remove('hidden');
            log('–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ –∫–æ–º–Ω–∞—Ç–µ ' + room);
        });

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥—ã (–∞–¥–º–∏–Ω)
        window.sendCommand = async function(cmd) {
            if (!isAdmin) {
                alert('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–º–∞–Ω–¥—ã');
                return;
            }
            try {
                const res = await fetch(`${SERVER_URL}/api/admin/command`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        room: currentRoom,
                        password: '7355608',
                        command: cmd
                    })
                });
                const data = await res.json();
                if (data.error) throw new Error(data.error);
                log('–ö–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞: ' + cmd);
            } catch (err) {
                alert('–û—à–∏–±–∫–∞: ' + err.message);
            }
        };

        // –û–ø—Ä–æ—Å –∫–æ–º–∞–Ω–¥ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
        function startPolling(room) {
            if (pollInterval) clearInterval(pollInterval);
            pollInterval = setInterval(async () => {
                try {
                    const res = await fetch(`${SERVER_URL}/api/client/poll?room=${room}`);
                    const data = await res.json();
                    if (data.command) {
                        executeCommand(data.command);
                    }
                } catch (err) {
                    console.error('–û—à–∏–±–∫–∞ –æ–ø—Ä–æ—Å–∞:', err);
                }
            }, 2000); // –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        }

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞
        function executeCommand(cmd) {
            log('–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞: ' + cmd);
            const clientCommandsDiv = document.getElementById('clientCommands');
            if (clientCommandsDiv) {
                clientCommandsDiv.innerHTML += `<p>‚û°Ô∏è ${cmd}</p>`;
            }

            switch (cmd) {
                case 'rickroll':
                    window.open('https://www.youtube.com/watch?v=dQw4w9WgXcQ', '_blank');
                    break;
                case 'notify':
                    if (Notification.permission === 'granted') {
                        new Notification('–° 1 –∞–ø—Ä–µ–ª—è!', { body: '–í–∞—Å —Ä–∞–∑—ã–≥—Ä–∞–ª–∏ üòÑ' });
                    } else if (Notification.permission !== 'denied') {
                        Notification.requestPermission().then(perm => {
                            if (perm === 'granted') {
                                new Notification('–° 1 –∞–ø—Ä–µ–ª—è!', { body: '–í–∞—Å —Ä–∞–∑—ã–≥—Ä–∞–ª–∏ üòÑ' });
                            }
                        });
                    }
                    break;
                case 'beep':
                    try {
                        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                        const oscillator = audioCtx.createOscillator();
                        oscillator.type = 'sine';
                        oscillator.frequency.setValueAtTime(880, audioCtx.currentTime);
                        oscillator.connect(audioCtx.destination);
                        oscillator.start();
                        oscillator.stop(audioCtx.currentTime + 0.3);
                    } catch (e) {
                        console.log('–ó–≤—É–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                    }
                    break;
                case 'changebg':
                    document.body.style.backgroundColor = '#' + Math.floor(Math.random()*16777215).toString(16);
                    break;
                case 'alert':
                    alert('–° 1 –∞–ø—Ä–µ–ª—è! üòâ');
                    break;
                case 'vibrate':
                    if (navigator.vibrate) {
                        navigator.vibrate([500, 200, 500]);
                    }
                    break;
                case 'getLocation':
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(pos => {
                            const coords = `–®–∏—Ä–æ—Ç–∞: ${pos.coords.latitude}, –î–æ–ª–≥–æ—Ç–∞: ${pos.coords.longitude}`;
                            alert('–í–∞—à–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ' + coords);
                            log('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã: ' + coords);
                        }, err => {
                            alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é');
                        });
                    } else {
                        alert('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                    }
                    break;
                case 'openWindow':
                    window.open('', '_blank', 'width=300,height=200').document.write('<h1>–° 1 –∞–ø—Ä–µ–ª—è!</h1>');
                    break;
                default:
                    log('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: ' + cmd);
            }
        }

        function log(msg) {
            logDiv.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${msg}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
    </script>
</body>
</html>
